<template>
    <require from="./stories.css"></require>
    <section class="container content-area">
        <!--<div class="row top-head" css="height:96px;margin-top:60px;background-image:url('${theme.files.top_background}');">
            <div style="padding-top:0px;padding-right:15px;">
                <h1 dir="rtl">${"stories.place-stories" & t}</h1>
            </div>
        </div>-->
        <div class="row content-area" style="width:100%;margin-top:100px;padding-right:36px;" dir="rtl">
            <div class="row" style="height:675px;">
                <div class="col-md-1">
                </div>
                <div class="col-md-8">
                    <div class="row" style="margin-bottom:15px;padding-right:32px;">
                        <form class="form-inline">
                            <div class="input-group" style="width:400px;" if.bind="user.privileges.DEVELOPER">
                                <search-input value.bind="filter" 
                                    placeholder="stories.filter" height="38"
                                    change.delegate="update_story_list()">
                                </search-input>
                            </div>
                            <div class="form-group" if.bind="phase=='can-modify-tags'">
                                <button class="btn btn-basic btn-md" click.trigger="save_merges($event)">
                                    ${'photos.save-merges' & t}
                                </button>
                                <help topic="photos.can-modify-tags", position="bottom"></help>
                            </div>
                            <div class="form-group" if.bind="user.editing && checked_stories.size == 0">
                                <a route-href="route: story-detail; params.bind: {id:'new', used_for: api.constants.story_type.STORY4EVENT}" class="btn btn-success cl-create-btn">
                                    <i class="far fa-plus-square"></i>
                                    ${'stories.new' & t}
                                </a>
                            </div>
                            <div class="form-group" if.bind="user.editing && checked_stories.size>0">
                                <button class="btn btn-warning btn-md" click.trigger="delete_checked_stories()">
                                    <i class="far fa-trash-alt fa-xs"></i>
                                </button>
                            </div>
                            <div class="form-group">
                                <button if.bind="user.editing && checked_stories.size > 0 && params.grouped_selected_topics.length==0 && params.selected_topics.length>0"
                                    class="btn btn-basic btn-md">
                                    ${'stories.apply-to-selected' & t}
                                </button>
                            </div>
                            <div class="form-group">
                                <button if.bind="user.editing && checked_stories.size > 1"
                                    class="btn btn-basic btn-md"
                                    click.trigger="consolidate_stories()">
                                    ${'stories.consolidate-selected-story' & t}
                                </button>
                            </div>
                            <div class="form-group">
                                <button if.bind="user.editing && checked_stories.size > 0 && user.privileges.ADMIN"
                                    class="btn btn-basic btn-md"
                                    click.trigger="promote_stories()">
                                    ${'stories.promote-selected-stories' & t}
                                </button>
                            </div>
                        </form>
                    </div>
                    <span if.bind="no_results"><h2>${'no-results' & t}</h2></span>
                    <ul style="width:100%;padding:0;float:right;height:560px;overflow:auto;list-style-type: none;padding-left:20px;">
                        <li repeat.for="story of story_list | filter: filter : 'name' : 'author' | take : 9999 | sort : 'name'" dir="rtl" 
                            style="float:right;border-bottom:2px solid lightgray;padding-bottom:20px;position:relative;width:100%;">
                            <div style="height:130px;overflow:hidden;padding-right:20px;padding-left:20px;padding-top:0px;">
                                <div style="margin-bottom: 10px;" aubs-tooltip="text.bind:story.topics">
                                    <editable settings.bind="{show_date:false, class:'story-section', checkable: true}" 
                                        story.bind="story" change.delegate="toggle_story_selection(story, $event)">
                                    </editable>
                                </div>
                            </div>
                            <div style="position:absolute;top:132px;left:20px;">
                                <a click.delegate="jump_to_the_full_story(story)" style="cursor:pointer;">
                                    <span if.bind="story.used_for==api.constants.story_type.STORY4EVENT">
                                        ${'stories.to-the-full-story' & t }...
                                    </span>
                                    <span if.bind="story.used_for==api.constants.story_type.STORY4MEMBER">
                                        ${'stories.to-the-member-page' & t }...
                                    </span>
                                    <span if.bind="story.used_for==api.constants.story_type.STORY4PHOTO">
                                        ${'stories.to-the-photo-page' & t }...
                                    </span>
                                    <span if.bind="story.used_for==api.constants.story_type.STORY4TERM">
                                        ${'stories.term-page' & t }...
                                    </span>
                                </a>
                            </div>
                        </li>
                    </ul>

                </div>
                <div class="col-md-3">
                    <div class="row">
                        <div style="margin-top: 0px;margin-bottom:2px;font-size:120%">${'stories.story-types' & t}</div>
                        <multi-select options.bind="story_types" 
                            place_holder_text="stories.story-types" 
                            ungrouped_selected_options.bind="params.selected_story_types"
                            height="110" settings.bind="story_types_settings"
                            change.delegate="handle_story_types_change($event) ">
                        </multi-select>
                    </div>
                    <div class="row" style="position:relative;">
                        <div style="margin-top: 0px;margin-bottom:2px;font-size:120%">${'stories.categories' & t}</div>
                        <help topic="tags" position="left" style="position:absolute;left:0px;top:26px;"></help>
                        <multi-select options.bind="topic_list" 
                            place_holder_text="photos.click-topic" 
                            ungrouped_selected_options.bind="params.selected_topics"
                            grouped_selected_options.bind="params.grouped_selected_topics"
                            height="120" 
                            settings.bind="options_settings" 
                            change.delegate="handle_topic_change($event)"
                            style="margin-top:5px;">
                        </multi-select>
                    </div>
                    <div if.bind="false" class="row">
                        <multi-select options.bind="used_languages" 
                            place_holder_text="stories.languages" 
                            height="80" 
                            change.delegate="handle_languages_change($event) ">
                        </multi-select>
                    </div>
                    <div if.bind="user.privileges.ADVANCED && user.editing" class="row">
                        <button class="btn btn-${params.link_class} btn-xs" 
                            click.trigger="toggle_link_class()" t="[title]stories.older-links">
                            <i class="fa fa-link fa-xs"></i>
                        </button>
                        <button class="btn btn-xs ${params.deleted_stories ? 'active' : ''}" 
                            click.trigger="toggle_deleted_stories()" t="[title]stories.undelete">
                            <i class="far fa-trash-alt fa-rotate-180 fa-xs"></i>
                        </button>
                    </div>
                    <div class="row" style="position:relative;">
                        <span if.bind="num_of_stories">${num_of_stories} ${'stories.matching-stories' & t}</span>
                        <span if.bind="! num_of_stories">&nbsp;</span>
                        <div style="margin-top: 0px;margin-bottom:2px;font-size:120%">${'stories.words' & t}</div>
                        <help topic="words" position="top" style="position:absolute;left:0px;top:46px;" params.bind="help_data"></help>
                        <multi-select 
                            options.bind="stories_index" 
                            ungrouped_selected_options.bind="params.selected_words"
                            grouped_selected_options.bind="params.grouped_selected_words"
                            keywords.two-way="keywords"
                            place_holder_text="stories.word-index" 
                            height="201" 
                            change.delegate="handle_words_change($event)" 
                            settings.bind="words_settings">
                        </multi-select>
                    </div>
                    <div class="row" style="margin-top: 20px;" if.bind="user.editing">
                        <form role="form">
                            <select value.bind="params.days_since_update" style="height:32px;width:90%;" change.delegate="handle_age_change($event)">
                                <option repeat.for="option of days_since_update_options" model.bind="option">${option.name}</option>
                            </select>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </section>
</template>
