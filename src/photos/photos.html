<template>
    <require from='./photos.css'></require>
    <section class="container content-area photos" css="height: ${win_height-265}px;">
        <div class="row content-area" style="height:380px;width:100%;margin-bottom:24px;margin-top:100px;padding-right:24px;" dir="rtl">
            <div class="row">
                <div class="col-md-1" css="padding-top: 40px;position:relative">
                    <span css="position:absolute"></help>${'photos.more' & t}<help topic="photos.slider" position="right"></span>
                    <input type="range" id="range" min="4" max="32" step="1" change.trigger="slider_changed()" value.bind="photos_per_line" />
                    <span css="position:absolute">${'photos.less' & t}</span>
                </div>
                <div class="col-md-8">
                    <div class="row" style="margin-bottom:15px;padding-right:15px;">
                        <form class="form-inline">
                            <div class="input-group">
                                <search-input value.bind="filter" placeholder="photos.filter" height="32"></search-input>
                            </div>
                            <div class="form-group" if.bind="caller_type=='story'">
                                <button class="btn btn-basic btn-md" click.delegate="select_member($event)">
                                    ${'photos.search-member' & t}
                                </button>
                            </div>
                            <div class="form-group" if.bind="phase=='can-modify-tags'">
                                <button class="btn btn-basic btn-md" click.trigger="save_merges($event)">
                                    ${'photos.save-merges' & t}
                                </button>
                                <help topic="photos.can-modify-tags", position="bottom"></help>
                            </div>
                            <div class="form-group">
                                <button if.bind="selected_photos.size > 0" t="[title]photos.download" class="btn btn-basic btn-md" click.delegate="download_photos()"><i class="fa fa-upload fa-rotate-180 fa-xs"></i></button>
                            </div>
                            <div class="form-group">
                                <button if.bind="user.privileges.ADMIN && selected_photos.size > 0" t="[title]photos.delete" class="btn btn-basic btn-md" click.delegate="delete_selected_photos()"><i class="far fa-trash-alt fa-xs"></i></button>
                            </div>
                            <div class="form-group">
                                <button if.bind="user.privileges.ADMIN && selected_photos.size > 0" t="[title]photos.rotate" class="btn btn-basic btn-md" click.delegate="rotate_selected_photos()"><i class="fa fa-undo fa-xs"></i></button>
                            </div>
                            <div class="form-group" if.bind="phase=='not-editing'">
                                <help topic="photos-not-editing" position="bottom"></help>
                            </div>
                            <div class="form-group" if.bind="phase=='ready-to-edit'">
                                <help topic="photos-ready-to-edit" position="bottom"></help>
                            </div>
                            <div class="form-group" if.bind="phase=='applying-to-photos'">
                                <button 
                                    disabled.bind="params.grouped_selected_topics.length>0 || (params.selected_topics.length==0 && params.selected_photographers.length != 1 && params.photos_date_str == '')"
                                    class="btn btn-basic btn-md" 
                                    click.trigger="apply_to_selected()">
                                    ${'photos.apply-to-selected' & t}
                                </button>
                                <help topic="apply-to-selected-photos" position="bottom"></help>
                            </div>
                            <div class="form-group" if.bind="phase=='selecting-photos'">
                                <button 
                                    click.trigger="finish_selecting()"
                                    class="btn btn-basic btn-md">
                                    ${'photos.done-selecting' & t}
                                </button>
                                <help topic="done-selecting-photos" position="bottom"></help>
                            </div>
                            <div if.bind="caller_type" class="form-group">
                                <button class="btn btn-success" click.trigger="save_photo_group()">
                                    ${'members.back-to-' + caller_type & t}
                                </button>
                            </div>
                            <div if.bind="phase == 'ready-to-edit' && user.privileges.PHOTO_UPLOADER && ! caller_type " t="[title]user.upload-files" class="input-group">
                                <a href click.trigger="upload_files()" class="btn btn-success cl-create-btn">
                                    <i class="far fa-plus-square"></i>
                                    ${'photos.upload' & t}
                                </a>
                            </div>
                        </form>
                    </div>
                    <div class="row" id="photos-container" style="height:560px;overflow:auto;direction:rtl;margin:0;padding:0;margin-bottom:16px;">
                        <span css="padding:0;margin:0;position:relative;width:${photo_size}px;height:${photo_size}px;"
                            repeat.for="photo of photo_list | filter : filter : '*selected' : 'title' | take : 9999">
                            <a click.trigger="maximize_photo(photo, $event)" tapandhold="500" longtouch.delegate="toggle_selection(photo, $event)" class.bind="photo.selected" >
                                <img src="${photo.square_src}" aubs-tooltip="text.bind:photo.title" width="${photo_size}" 
                                    height="${photo_size}" style="margin:0;cursor:pointer;" />
                            </a>
                           <!--a class="photo-maximizer" css="position:absolute;right:0px;top:${width/2}px;" 
                                click.trigger="maximize_photo(photo, $event)">
                                <i class="fa fa-expand fa-xs"></i>
                            </a-->
                        </span>
                    </div>
                </div>
                <div class="col-md-3" style="padding-right:6px;">
                    <div class="row" style="margin-bottom:15px;position:relative;" if.bind="user.privileges.DEVELOPER">
                        <help topic="tags" position="bottom" style="position:absolute;left:2px;top:2px;"></help>
                        <multi-select-new options.bind="topic_list"
                            settings.bind="options_settings"
                            ungrouped_selected_options.bind="params.selected_topics"
                            grouped_selected_options.bind="params.grouped_selected_topics"
                            name="topics"
                            place_holder_text="photos.click-topic"
                            change.delegate="handle_topic_change($event) ">
                        </multi-select-new>
                    </div>
                    <div class="row" style="margin-bottom:15px;position:relative;" if.bind="! user.privileges.DEVELOPER">
                        <help topic="tags" position="bottom" style="position:absolute;left:2px;top:2px;"></help>
                        <multi-select options.bind="topic_list"
                            settings.bind="options_settings"
                            ungrouped_selected_options.bind="params.selected_topics"
                            grouped_selected_options.bind="params.grouped_selected_topics"
                            name="topics"
                            place_holder_text="photos.click-topic"
                            change.delegate="handle_topic_change($event) ">
                        </multi-select>
                    </div>
                    <div class="row">
                        <multi-select options.bind="photographer_list"
                            place_holder_text="photos.click-photographer"
                            ungrouped_selected_options.bind="params.selected_photographers"
                            settings.bind="photographers_settings"
                            change.delegate="handle_photographer_change($event)">
                        </multi-select>
                    </div>
                    <div class="row" style="margin-top: 10px;">
                        <form role="form">
                            <select value.bind="params.selected_days_since_upload" style="height:32px;width:90%;" change.delegate="handle_change($event)">
                                <option repeat.for="option of days_since_upload_options" model.bind="option">${option.name}</option>
                            </select>
                        </form>
                    </div>
                    <div class="row" style="margin-top: 10px;" if.bind="user.isLoggedIn">
                        <form role="form">
                            <select value.bind="params.selected_uploader" style="height:32px;width:90%;" change.delegate="handle_change($event)">
                                <option repeat.for="option of uploader_options" model.bind="option.value">${option.name}</option>
                            </select>
                        </form>
                    </div>
                    <div class="row" style="margin-top: 10px;" if.bind="user.isLoggedIn">
                        <form role="form">
                            <select value.bind="params.selected_dates_option" style="height:32px;width:90%;" change.delegate="handle_change($event)">
                                <option repeat.for="option of dates_options" model.bind="option.value">${option.name}</option>
                            </select>
                        </form>
                    </div>
                    <div class="row" style="margin-top: 10px;float:right;" if.bind="can_set_dates">
                        <date-range 
                            label="${'photos.photos-date' & t}" 
                            base_date_str.bind="params.photos_date_str"
                            range_options.bind="[1,2,3,5,10, 20, 50, 100, 120]" 
                            date_span_size.bind="params.photos_date_span_size">
                        </date-range>
                    </div>
                </div>
            </div>
            <div class="row" style="width:100%;margin-right:-26px;" if.bind="!can_set_dates">
                <timeline first_year.bind="params.first_year" last_year.bind="params.last_year" change.delegate="time_range_changed($event)"></timeline>
            </div>
        </div>
    </section>
</template>
