<template>
    <section class="container content-area photos" css="css_height()">
        <div class="row content-area unselectable" id="photos-area" dir="${theme.rtltr}">
            <div class="row" style="margin-right:0;margin-left:0;">
                <div class="col-md-1 hide-if-small" css="padding-top: 40px;position:relative">
                    <span style="position:absolute">${'photos.more-smaller' & t}<help topic="photos.slider" position="right"></help></span>
                    <input type="range" min="4" max="32" step="1"
                        change.trigger="slider_changed()" value.bind="photos_per_line" 
                        style="position:absolute;top:82px;left:4px;"
                        class="range vertical-lowest-first round" />
                    <span style="position:absolute;top:150px">${'photos.larger' & t}</span>
                    <span style="position:absolute;top:200px">${photo_list.length} ${'photos.photos' & t}</span>
                </div>
                <div class="col-md-8">
                    <div class="row" style="margin-bottom:15px;padding-right:15px;">
                        <form style="display:flex;height:34px;">
                            <div class="input-group" if.bind="user.privileges.ADVANCED">
                                <search-input value.bind="filter" placeholder="photos.filter" height="32"></search-input>
                            </div>
                            <div class="input-group" if.bind="user.privileges.EDITOR" style="width:144px;">
                                <select value.bind="params.selected_order_option" style="height:32px;width:90%;" change.delegate="handle_order_change($event)">
                                    <option repeat.for="option of order_options" model.bind="option.value">${option.name}</option>
                                </select>
                            </div>
                            <div class="input-group" if.bind="params.selected_order_option == 'upload-time-order'">
                                <button t="[title]videos.next" class="btn btn-default" click.delegate="next($event)" disabled.bind="next_disabled"><i class="fas fa-chevron-right"></i></button>
                                <button t="[title]videos.prev" class="btn btn-default" click.delegate="prev($event)" disabled.bind="prev_disabled"><i class="fas fa-chevron-left"></i></button>
                            </div>
                            <div if.bind="(! got_duplicates) && params.photo_ids.length == 0 && params.selected_order_option == 'random-order'" class="form-group hide-if-small">
                                <button class="btn btn-basic btn-md" click.delegate="select_member($event)">
                                    ${with_a_member_text}
                                </button>
                            </div>
                            <div if.bind="params.photo_ids.length > 0" class="form-group hide-if-small">
                                <button class="btn btn-basic btn-md" click.delegate="show_all_photos($event)">
                                    ${'photos.any-photo' & t}
                                </button>
                            </div>
                            <div class="form-group" if.bind="phase=='can-merge-topics'">
                                <button class="btn btn-basic btn-md" click.trigger="save_merges($event)">
                                    ${'photos.save-merges' & t}
                                </button>
                                <help topic="photos.can-modify-tags", position="bottom"></help>
                            </div>
                            <div if.bind="phase=='can-create-group'" class="form-group">
                                <button class="btn btn-basic btn-md" click.trigger="save_topic_group($event)">
                                    ${'photos.save-topic-group' & t}
                                </button>
                                <help topic="photos.can-create-group", position="bottom"></help>
                            </div>
                            <div class="form-group">
                                <button if.bind="selected_photos.size > 0" t="[title]photos.download" class="btn btn-basic btn-md" click.delegate="download_photos()"><i class="fa fa-upload fa-rotate-180 fa-xs"></i></button>
                            </div>
                            <div class="form-group">
                                <button if.bind="user.privileges.ADMIN && user.editing && selected_photos.size > 0" t="[title]photos.delete" class="btn btn-basic btn-md" click.delegate="delete_selected_photos()"><i class="far fa-trash-alt fa-xs"></i></button>
                            </div>
                            <div class="form-group">
                                <button if.bind="user.privileges.ADMIN && selected_photos.size > 0" t="[title]photos.rotate" class="btn btn-basic btn-md" click.delegate="rotate_selected_photos()"><i class="fa fa-undo fa-xs"></i></button>
                            </div>
                            <div class="form-group" if.bind="! editing_filters">
                                <button class="btn btn-basic btn-sm btn-framed" 
                                    style="margin-right:20px;margin-left:20px;"
                                    if.bind="! theme.is_desktop" 
                                    click.delegate="show_filters_only()">${'photos.edit-filters' & t}
                                </button>
                            </div>
                            <div class="form-group" if.bind="can_pair_photos">
                                <button t="[title]photos.pair" class="btn btn-basic btn-md" click.delegate="pair_selected_photos()"><i class="far fa-yin-yang"></i></i></button>
                            </div>
                            <div class="form-group" if.bind="phase=='photos-ready-to-edit' && ! after_upload">
                                <help topic="photos-ready-to-edit" position="bottom"></help>
                            </div>
                            <div class="form-group" if.bind="after_upload">
                                <help topic="after-upload" position="bottom"></help>
                            </div>
                            <div class="form-group" if.bind="phase=='applying-to-photos' && ! got_duplicates && ! working">
                                <button 
                                    disabled.bind="params.selected_topics.length==0 && params.selected_photographers.length != 1 && params.photos_date_str == ''"
                                    class="btn btn-basic btn-md" 
                                    click.trigger="apply_to_selected()">
                                    ${'photos.apply-to-selected' & t}
                                </button>
                                <help topic="apply-to-selected-photos" position="bottom"></help>
                            </div>
                            <div class="input-group" if.bind="phase == 'selecting-photos-for-story'">
                                <help topic.bind="phase" position="bottom"></help>
                            </div>
                            <div if.bind="caller_type" class="form-group">
                                <button class="btn btn-success" click.trigger="save_photo_group()">
                                    ${'members.back-to-' + caller_type & t}
                                </button>
                            </div>
                            <div if.bind="phase == 'photos-ready-to-edit' && user.privileges.PHOTO_UPLOADER && ! caller_type && ! got_duplicates && ! working" t="[title]user.upload-files" class="input-group">
                                <a href click.trigger="upload_files()" class="btn btn-success cl-create-btn">
                                    <i class="far fa-plus-square"></i>
                                    ${'photos.upload' & t}
                                </a>
                            </div>
                            <div if.bind="user.privileges.ADMIN && user.editing && ! caller_type && ! got_duplicates && ! working" class="input-group">
                                <button 
                                    click.trigger="find_duplicates()"
                                    class="btn btn-basic btn-md">
                                    ${'photos.find-duplicates' & t}
                                </button>
                            </div>
                            <div if.bind="user.editing && ! caller_type && ! working && got_duplicates && selected_photos.size > 0" class="input-group">
                                <button 
                                    click.trigger="replace_duplicate_photos()"
                                    class="btn btn-basic btn-md">
                                    ${'photos.keep-selected-photos' & t}
                                </button>
                            </div>
                            <div if.bind="user.editing && ! caller_type && ! working && candidates.size > 0" class="input-group">
                                <button 
                                    click.trigger="select_new_copies()"
                                    class="btn btn-basic btn-md">
                                    ${'photos.select-new-copies' & t}
                                </button>
                            </div>
                            <div if.bind="user.editing && got_duplicates" class="input-group">
                                <button 
                                    click.trigger="show_all_photos()"
                                    class="btn btn-basic btn-md">
                                    ${'photos.show-all-photos' & t}
                                </button>
                            </div>
                        </form>
                    </div>
                    <h3 if.bind="empty" innerhtml.bind="'no-results' & t">
                    </h3>
                    <div class="row ${empty ? 'empty-photos' : ''}" id="photos-container" ref="scroll_area"
                        if.bind="!editing_filters">
                        <div css="width:${photo_size}px;height:${photo_size}px;"
                            class="${photo.photo_id==curr_photo_id ? 'current-photo' : ''}"
                            repeat.for="photo of photo_list | filter : filter : '*selected' : 'name' : 'original_file_name' | take : 9999">
                            <a style="position:relative;width:100%" click.delegate="maximize_photo(photo, $event, $index)" tapandhold="500" longtouch.delegate="toggle_selection(photo)" 
                                class.bind="photo.selected" >
                                <info css="position:absolute;top:${7 - photo_size / 2}px;left:${photo_size-20}px;"
                                    title.bind="photo_info_title(photo)" content.bind="photo_info_content(photo)"></info>
                                <img src="${photo[photo.side].square_src}"  width="${photo_size}" 
                                    height="${photo_size}" style="margin:0;cursor:pointer;" class.bind="photo.flipable + ' ' + photo.status" 
                                    draggable="false" />
                            </a>
                        </div>
                    </div>
                </div>
                <div id="photo-filters-panel" class="col-md-3 col-sm-12 ${theme.rtltr}" if.bind="theme.is_desktop || editing_filters">
                    <div class="row multi-select-div" style="margin-bottom:15px;position:relative;">
                        <div style="margin-top: 0px;margin-bottom:2px;font-size:120%">${'stories.categories' & t}</div>
                        <help if.bind="phase=='photos-ready-to-edit'" topic="photos.ready-to-edit", position="bottom" style="position:absolute;left:2px;top:2px;"></help>
                        <help if.bind="phase=='applying-to-photos'" topic="apply-to-selected-photos", position="bottom" style="position:absolute;left:2px;top:2px;"></help>
                        <help if.bind="phase=='photos-not-editing'" topic="tags" position="${theme.is_desktop ? 'bottom' : 'right'}" style="position:absolute;left:2px;top:2px;"></help>
                        <multi-select options.bind="topic_list"
                            category="topic"
                            selected_options.bind="params.selected_topics"
                            settings.bind="options_settings"
                            has_groups.bind="has_grouped_topics"
                            option_groups.bind="topic_groups"
                            first_time.bind="no_topics_yet"
                            new-name.delegate="add_topic($event)"
                            remove-option.delegate="remove_topic($event)"
                            name-changed.delegate="topic_name_changed($event)"
                            highlight_unselectors.bind="highlight_unselectors"
                            name="topics"
                            place_holder_text="photos.click-topic"
                            clear_selections_now.bind="clear_selected_topics_now"
                            ms-change.delegate="handle_topic_change($event) ">
                        </multi-select>
                    </div>
                    <div class="row multi-select-div">
                        <div style="margin-top: 0px;margin-bottom:2px;font-size:120%">${'photos.photographers' & t}</div>
                        <multi-select options.bind="photographer_list"
                            category="photographer"
                            place_holder_text="photos.click-photographer"
                            selected_options.bind="params.selected_photographers"
                            first_time.bind="no_photographers_yet"
                            settings.bind="photographers_settings"
                            has_groups.bind="has_grouped_photographers"
                            new-name.delegate="add_photographer($event)"
                            remove-option.delegate="remove_photographer($event)"
                            name-changed.delegate="photographer_name_changed($event)"
                            clear_selections_now.bind="clear_selected_phototgraphers_now"
                            ms-change.delegate="handle_photographer_change($event)">
                        </multi-select>
                    </div>
                    <div show.bind="user_editing"></div> <!-- To ensure response to editing mode change -->
                    <div class="row" style="margin-top: 10px;">
                        <form role="form">
                            <select value.bind="params.selected_days_since_upload" style="height:32px;width:90%;" change.delegate="handle_change($event)">
                                <option repeat.for="option of days_since_upload_options" model.bind="option">${option.name}</option>
                            </select>
                        </form>
                    </div>
                    <div class="row" style="margin-top: 10px;" if.bind="user.isLoggedIn">
                        <form role="form">
                            <select value.bind="params.selected_uploader" style="height:32px;width:90%;" change.delegate="handle_change($event)">
                                <option repeat.for="option of uploader_options" model.bind="option.value">${option.name}</option>
                            </select>
                        </form>
                    </div>
                    <div class="row" style="margin-top: 10px;" if.bind="user.isLoggedIn">
                        <form role="form">
                            <select value.bind="params.selected_dates_option" style="height:32px;width:90%;" change.delegate="handle_change($event)">
                                <option repeat.for="option of dates_options" model.bind="option.value">${option.name}</option>
                            </select>
                        </form>
                    </div>
                    <div class="row" style="margin-top: 10px;" if.bind="user.editing">
                        <form role="form">
                            <select value.bind="params.selected_recognition" style="height:32px;width:90%;" change.delegate="handle_change($event)">
                                <option repeat.for="option of recognition_options" model.bind="option.value">${option.name}</option>
                            </select>
                        </form>
                    </div>
                    <div class="row" style="margin-top: 10px;margin-left:14px;" if.bind="can_set_dates">
                        <date-range 
                            label="photos.photos-date" 
                            base_date_str.bind="params.photos_date_str"
                            range_options.bind="[1,2,3,5,10, 20, 50, 100, 120]" 
                            span_size.bind="params.photos_date_span_size">
                        </date-range>
                    </div>
                </div>
            </div>
            <div class="row hide-if-small" style="width:100%;margin:0px;">
                <timeline first_year.bind="params.first_year" last_year.bind="params.last_year" change.delegate="time_range_changed($event)"></timeline>
            </div>
        </div>
    </section>
</template>
