<template class="multi-select">
    <require from="./multi-select.css">
    </require>
    <div class="input-group search-filter" if.bind="options.length > 10">
        <search-input value.bind="filter" placeholder.bind="place_holder_text" height="32"></search-input>
    </div>
    <div class="ms-container" css="height:${filter || ! settings.show_only_if_filter ? height : 0}px;position:relative">
        <button if.bind="can_add" 
            style="position:absolute;top:60px;left:140px;padding:0;"
            click_trigger="add_item()" 
            class="btn btn-success btn-xs cl-create-btn">
            <dlg-string str.bind="new_item_name" 
                placeholder.bind="new_item_placeholder" 
                anchor.bind="anchor"
                title.bind="new_item_title">
            </dlg-string>
        </button>
        <div class="row options selected" css="max-height:${height_selected}px;">
            <!-- First  display grouped options. may be add a popover with names of all group members-->
            <ul if.bind="grouped_selected_options.length>0" class="grouped" css="width:${width}px;">
                <li repeat.for="option of grouped_selected_options" class="selected" css="width:${inner_width}px;">
                    <div class="option-item" css="margin:0;padding:0;width:${inner_width}px">
                        <span class="span-a">
                            <a click.trigger="toggle_selection(option)" aubs-tooltip="text.bind:option.names; position:right;class:ms-tooltip;">
                                ${option.name}
                            </a>
                            <span class="span-i">
                                <a click.trigger="unmerge_options(option, $event)">
                                    <i class="fa fa-paperclip fa-rotate-90 tool" aubs-tooltip="text.bind:why_unclip;position: top;class:ms-tooltip;"></i>
                                </a>
                                <!--<a if.bind="user.advanced && !user.editing" click.trigger="toggle_sign(option, $event)">
                                    <-- The rotatate-180 thing here and below is kind of voodoo. It is crazy without it >
                                    <i class="fa fa-${option.sign}-square-o fa-rotate-180 tool"></i>
                                </a>-->
                            </span>
                        </span>
                    </div>
                </li>
            </ul>
            <!-- Second come all ungrouped options -->
            <ul css="width:${width}px;">
                <li repeat.for="option of ungrouped_selected_options" class="selected" css="width:${inner_width}px;">
                    <div class="option-item" css="margin:0;padding:0;width:${inner_width}px">
                        <span class="span-a">
                            <a click.trigger="toggle_selection(option)">
                                ${option.name}
                            </a>
                            <span class="span-i">
                                <a if.bind="can_merge" click.trigger="merge_options(option, $event)">
                                    <i class="fa fa-paperclip fa-rotate-90 tool" aubs-tooltip="text.bind:why_clip;position: top;class:ms-tooltip;"></i>
                                </a>
                                <a if.bind="can_set_sign" click.trigger="toggle_sign(option, $event)">
                                    <i class="fa fa-${option.sign}-square-o fa-rotate-180 tool"></i>
                                </a>
                                <a if.bind="can_edit_name" click.trigger="edit_option(option, $event)">
                                    <i class="fa fa-pencil fa-rotate-180 fa-rotate-180 tool"></i>
                                </a>
                                <a if.bind="can_delete" click.trigger="remove_option(option, $event)">
                                    <i class="fa fa-trash fa-rotate-180 tool"></i>
                                </a>
                            </span>
                        </span>
                    </div>
                </li>
            </ul>
        </div>
        <!-- Under the line come all unselected options -->
        <div class="row options unselected" 
            css="max-height:${filter || display_option_list ? height_unselected : 0}px;" 
            if.bind="options && options.length > 0 && (filter.length > 0 || ! settings.show_only_if_filter)">
            <ul css="width:${width}px;" if.bind="true || unselected_options===[]">
                <li repeat.for="option of options | filter: filter : 'name' | filterBySet : all_selected : 'exclude' | take : 199">
                    <div class="option-item" css="margin:0;padding:0;padding-right:2px;width:${inner_width}px">
                        <a click.trigger="toggle_selection(option)">${option.name}</a>
                    </div>
                </li>
            </ul>
        </div>
    </div>

</template>